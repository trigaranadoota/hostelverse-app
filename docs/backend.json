{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile in the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "firstName": {
          "type": "string",
          "description": "User's first name."
        },
        "lastName": {
          "type": "string",
          "description": "User's last name."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "preferredLanguage": {
          "type": "string",
          "description": "User's preferred language."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "preferredLanguage"
      ]
    },
    "Hostel": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Hostel",
      "type": "object",
      "description": "Represents a hostel entity.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the hostel."
        },
        "name": {
          "type": "string",
          "description": "Name of the hostel."
        },
        "address": {
          "type": "string",
          "description": "Address of the hostel."
        },
        "contactNumber": {
          "type": "string",
          "description": "Contact number of the hostel."
        },
        "amenities": {
          "type": "array",
          "description": "List of amenities offered by the hostel.",
          "items": {
            "type": "string"
          }
        },
        "feeStructure": {
          "type": "string",
          "description": "Fee structure details of the hostel."
        }
      },
      "required": [
        "id",
        "name",
        "address",
        "contactNumber",
        "amenities",
        "feeStructure"
      ]
    },
    "Review": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Review",
      "type": "object",
      "description": "Represents a review given by a resident for a hostel.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the review."
        },
        "hostelId": {
          "type": "string",
          "description": "Reference to Hostel. (Relationship: Hostel 1:N Review)"
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Review)"
        },
        "text": {
          "type": "string",
          "description": "Text content of the review."
        },
        "foodRating": {
          "type": "number",
          "description": "Star rating for food."
        },
        "cleanlinessRating": {
          "type": "number",
          "description": "Star rating for cleanliness."
        },
        "managementRating": {
          "type": "number",
          "description": "Star rating for management."
        },
        "safetyRating": {
          "type": "number",
          "description": "Star rating for safety."
        }
      },
      "required": [
        "id",
        "hostelId",
        "userId",
        "text",
        "foodRating",
        "cleanlinessRating",
        "managementRating",
        "safetyRating"
      ]
    },
    "Room": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Room",
      "type": "object",
      "description": "Represents a room in a hostel.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the room."
        },
        "hostelId": {
          "type": "string",
          "description": "Reference to Hostel. (Relationship: Hostel 1:N Room)"
        },
        "roomNumber": {
          "type": "string",
          "description": "Room number or identifier."
        },
        "availability": {
          "type": "string",
          "description": "Availability status of the room (e.g., available, occupied, maintenance)."
        }
      },
      "required": [
        "id",
        "hostelId",
        "roomNumber",
        "availability"
      ]
    },
    "Wishlist": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Wishlist",
      "type": "object",
      "description": "Represents a user's wishlist for rooms.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the wishlist item."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Wishlist)"
        },
        "roomId": {
          "type": "string",
          "description": "Reference to Room. (Relationship: Room 1:N Wishlist)"
        }
      },
      "required": [
        "id",
        "userId",
        "roomId"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/profile",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. Path-based ownership ensures only the authenticated user can access their profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/hostels/{hostelId}",
        "definition": {
          "entityName": "Hostel",
          "schema": {
            "$ref": "#/backend/entities/Hostel"
          },
          "description": "Stores hostel data. Includes denormalized 'members' map for authorization independence.",
          "params": [
            {
              "name": "hostelId",
              "description": "The unique identifier of the hostel."
            }
          ]
        }
      },
      {
        "path": "/hostels/{hostelId}/reviews/{reviewId}",
        "definition": {
          "entityName": "Review",
          "schema": {
            "$ref": "#/backend/entities/Review"
          },
          "description": "Stores reviews for hostels. Each review contains the userId of the reviewer to authorize edit and delete operations",
          "params": [
            {
              "name": "hostelId",
              "description": "The unique identifier of the hostel."
            },
            {
              "name": "reviewId",
              "description": "The unique identifier of the review."
            }
          ]
        }
      },
      {
        "path": "/hostels/{hostelId}/rooms/{roomId}",
        "definition": {
          "entityName": "Room",
          "schema": {
            "$ref": "#/backend/entities/Room"
          },
          "description": "Stores rooms for hostels.",
          "params": [
            {
              "name": "hostelId",
              "description": "The unique identifier of the hostel."
            },
            {
              "name": "roomId",
              "description": "The unique identifier of the room."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/wishlist/{wishlistId}",
        "definition": {
          "entityName": "Wishlist",
          "schema": {
            "$ref": "#/backend/entities/Wishlist"
          },
          "description": "Stores wishlist items for users. Path-based ownership ensures only the authenticated user can access their wishlist.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "wishlistId",
              "description": "The unique identifier of the wishlist item."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to provide a secure, scalable, and easily debuggable system for HostelVerse, focusing on authorization independence and clear access patterns. \n\nWe are leveraging Structural Segregation to isolate user profiles and hostel data, applying path-based ownership for user-specific data and the Membership Map pattern for collaborative data.\n\nUserProfile:\n*   User profiles are stored under `/users/{userId}/profile` to establish clear ownership and simplify security rules. The `userId` parameter in the path directly corresponds to the authenticated user's ID, ensuring that only the user can access and modify their profile.\n\nHostel:\n*   Hostels are stored in a flat `/hostels` collection. Reviews, Rooms are stored in subcollections. The `members` map enables collaborative authorization.\n\nReviews:\n*   Reviews are stored in a `/hostels/{hostelId}/reviews/{reviewId}` subcollection, reflecting the 1:N relationship between Hostels and Reviews. Authorization is managed via the `userId` field in the review, ensuring only the author or hostel members can manage the review.\n\nRooms:\n*   Rooms are stored in a `/hostels/{hostelId}/rooms/{roomId}` subcollection to represent the 1:N relationship between Hostels and Rooms.\n\nWishlist:\n*   Wishlist items are stored under `/users/{userId}/wishlist/{wishlistId}`, clearly associating each wishlist with a user.\n\n\nAuthorization Independence:\n*   Authorization Independence is achieved by storing the user's role directly within the document, eliminating the need for complex `get()` calls to parent documents in security rules. This approach supports atomic operations and enhances security rule debuggability.\n\nQAPs (Rules are not Filters):\n*   The structure supports secure list operations through structural segregation. Private user data is stored under `/users/{userId}`, allowing simple rules to restrict access based on the authenticated user's ID. Public hostel data in `/hostels` can have more permissive rules while still maintaining security.\n\nDBAC (Database-Based Access Control):\n*   The membership map is used for collaborative data, offering flexibility in defining roles and permissions without relying on custom claims.\n"
  }
}